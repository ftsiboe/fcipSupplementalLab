% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/build_supplemental_adoption_dynamics.R
\name{get_supplemental_adoption}
\alias{get_supplemental_adoption}
\title{Build a Base-Policy Panel with Supplemental Adoption Measures from RMA SOB-TPU}
\usage{
get_supplemental_adoption(
  sob_full,
  supplemental_codes = c(31:33, 87:89, 35:36, 16:17, 67:69, 26:28, 37, 38),
  disaggregates = NULL
)
}
\arguments{
\item{sob_full}{A \code{data.table} of cleaned SOB-TPU records containing both base
and supplemental policies. Must include insured acres, endorsed acres,
financial totals, and standard FCIP identifier columns.}

\item{supplemental_codes}{Integer vector of supplemental insurance plan codes
to include. Defaults to a comprehensive set of FCIP supplemental products.}

\item{disaggregates}{Optional character vector defining the primary analysis
grain for adoption measures. Defaults to commodity-year by county by
commodity/type/practice.}
}
\value{
A \code{data.table} containing base insured acreage and financial totals at
the base-policy aggregation grain, augmented with one or more supplemental
adoption variables (ending in \code{"_share"}) and/or supplemental acreage totals
(ending in \code{"_area"}).
}
\description{
Constructs an analysis-ready panel of \strong{base insurance outcomes} and appends
measures of \strong{supplemental insurance adoption} and/or \strong{supplemental acreage
totals} for a user-specified set of FCIP supplemental products.

The function first aggregates base (individual-based) insurance outcomes from
\code{sob_full}, harmonizing plan code 90 to base plan 1 where applicable. It then
sequentially augments this base panel with supplemental adoption measures
computed via \code{get_supplemental_shares()} and with direct acreage aggregates
for selected area-based products.
}
\details{
Output content depends on which supplemental plan codes are supplied:

\itemize{
\item \strong{SCO (31-33):} Adds \code{sco_share}, measuring the share of base insured
acres stacked with SCO.

\item \strong{ECO (87-89):} Adds coverage-specific adoption measures
\code{eco90_share} and \code{eco95_share}.

\item \strong{PACE (26-28):} Adds \code{pace_share}.

\item \strong{HIP-WI (37):} Adds \code{hipwi_share} (not disaggregated by base plan or
coverage level).

\item \strong{FIP-SI (38):} Adds \code{fipsi_share}.

\item \strong{MP (16-17):} Adds \code{mp_area}, representing aggregated acres insured
under Margin Protection.

\item \strong{STAX (35-36):} Adds \code{stax_area}, representing aggregated acres
insured under STAX.
}

Adoption shares are based on \code{endorsed_acres} in the numerator and base-policy
\code{insured_acres} in the denominator. Area-based products (MP and STAX) are
returned as acreage totals rather than shares.

After all merges, the function enforces basic bounds:
\itemize{
\item Non-finite values are set to 0
\item Negative values are truncated to 0
\item Share variables are capped at 1
}
}
